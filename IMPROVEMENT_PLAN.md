# Clippy Improvement Plan
### Comprehensive Multi-Angle Analysis

> Generated by a 3-agent team: Features & UX Analyst, Technical Architect, Devil's Advocate.
> Each section synthesizes findings from all three perspectives.
> **Implementation status updated: All 4 phases implemented by a 3-agent team.**

---

## Implementation Status

| Phase | Task | Status | Agent |
|-------|------|--------|-------|
| Phase 1A | Security hardening (Keychain, API headers, logging, sensitive detection) | DONE | ux-designer |
| Phase 1B | Crash resilience (schema migration, safe casts, vector DB race, timer fix) | DONE | swift-architect |
| Phase 2 | Code cleanup (dead code, dedup, rename Clippyâ†’VectorSearchService) | DONE | ux-designer |
| Phase 3 | Status Bar Menu (MenuBarExtra, last 10 items, click-to-copy) | DONE | devils-advocate |
| Phase 4 | Architecture (QueryOrchestrator, ContentView 718â†’504 lines, unified AI state) | DONE | ux-designer |

### New Files Created
- `Clippy/Services/KeychainHelper.swift` â€” macOS Keychain save/load/delete
- `Clippy/Services/SensitiveContentDetector.swift` â€” Detects passwords, API keys, credit cards, SSNs
- `Clippy/Services/QueryOrchestrator.swift` â€” RAG pipeline extracted from ContentView
- `Clippy/UI/StatusBarMenu.swift` â€” Menu bar quick-access with last 10 items
- `Clippy/UI/SettingsView.swift` â€” Extracted from ContentView

### Files Deleted
- `Clippy/Services/AIActor.swift` â€” Dead code, never called

---

## Executive Summary

Clippy is a ~5,100 LOC macOS AI-powered clipboard manager with a genuinely interesting core concept â€” ask your clipboard questions and get answers. ~~However, the project has **critical security vulnerabilities**, **architectural debt**, and **over-engineering** that must be addressed before production use.~~ **The critical issues below have been addressed in the implementation phase.** The improvements below are prioritized by impact.

---

## P0 â€” CRITICAL (Fix Before Any Users Touch This)

### 1. Security: Clipboard Data Is Handled Unsafely

| Gap | Where | Fix |
|-----|-------|-----|
| API keys stored in plaintext UserDefaults | `ContentView.swift:595` | Migrate to macOS Keychain |
| Gemini API key passed in URL query param | `GeminiService.swift:221` | Move to `Authorization` header |
| All clipboard content sent to Gemini API unfiltered | `GeminiService.swift:143-178` | Add sensitive content detection (passwords, credit cards, API keys, SSNs) |
| Clipboard content logged to console | `GeminiService.swift:57,113`, `ClipboardMonitor.swift:69` | Remove all `print()` of user data; use `os_log` with `.private` |
| Partial API key logged | `ElevenLabsService.swift:15` | Remove entirely |
| App sandbox disabled | `Clippy.entitlements` | Evaluate minimum sandbox exceptions needed |
| `.env` file reading as fallback | `ContentView.swift:612-618` | Remove; use Keychain only |
| SwiftData DB unencrypted | All clipboard history | Enable `NSPersistentStoreDescription.setOption` for encryption |

### 2. Crash Resilience: App Dies on Schema Change

| Gap | Where | Fix |
|-----|-------|-----|
| `fatalError()` on ModelContainer failure | `ClippyApp.swift:21` | Implement SwiftData migration plan; graceful fallback with user prompt |
| Force casts on AXUIElement | `ContextEngine.swift:71,93,97,104,108` | Replace all `as!` with `as?` + guard |
| Force casts in ClippyWindowController | Lines 249, 304, 348 | Same â€” safe cast with fallback |

### 3. Data Loss: Vector DB Race Condition

| Gap | Where | Fix |
|-----|-------|-----|
| Items saved before vector DB initializes are never indexed | `ClipboardMonitor` starts before `Clippy.initialize()` completes | Queue items during init; reindex on startup; or block monitoring until ready |

---

## P1 â€” HIGH PRIORITY (Next Sprint)

### 4. Architecture: Extract Business Logic from Views

**Problem**: `ContentView.swift` (718 lines) is a god object containing the entire RAG pipeline, AI dispatch, settings management, input state machine, and voice recording logic.

**Fix**:
- Extract `ClipboardSearchService` â€” owns vector search, context building, deduplication
- Extract `QueryOrchestrator` â€” owns the Option+X capture â†’ search â†’ AI â†’ replace pipeline
- Extract `InputModeStateMachine` â€” owns the None â†’ TextCapture â†’ Thinking â†’ Done state transitions
- Move `SettingsView` to its own file
- Move `AIServiceType` and `InputMode` enums to `Models.swift`
- Make `ContentView` purely a thin UI shell that delegates to these services

### 5. Performance: Stop Burning CPU in the Background

| Gap | Where | Fix |
|-----|-------|-----|
| 0.5s timer polling clipboard + walking accessibility tree | `ClipboardMonitor.swift:56` | Use `NSPasteboard` change count diffing only; poll accessibility tree only when needed (on clipboard change) |
| Full `allItems` loaded into memory | `ContentView.swift:52` | Use SwiftData `fetchLimit` + pagination |
| O(n*m) item filtering after vector search | `ContentView.swift:353-361` | Build `Set<UUID>` or `Dictionary` for O(1) lookup |
| AI tag generation for every clipboard item | `ClipboardMonitor.swift:238-267` | Use deterministic heuristics (regex: URLs, emails, code, JSON) + AI only for ambiguous items |

### 6. Privacy Controls (Major Missing Feature)

Users **need** control over what gets stored and sent to AI:

- **Sensitive content detection**: Auto-detect passwords, API keys, credit cards, SSNs using regex patterns. Skip AI tagging/embedding for these.
- **Exclude-app list**: Let users exclude specific apps (e.g., 1Password, Terminal, banking apps) from clipboard monitoring.
- **Auto-expiry**: TTL for clipboard items (e.g., 24h, 7d, 30d). Sensitive items auto-expire faster.
- **Data retention dashboard**: Show how many items stored, total size, option to bulk-delete by date range.
- **Local-only mode**: Disable all cloud API calls with a single toggle.
- **Encryption at rest**: Encrypt the SwiftData database.

### 7. Testing: Zero â†’ Something

The project has **zero tests**. Priority test targets:

1. `ClipboardRepository` â€” data layer CRUD, deduplication logic
2. `GeminiService` â€” API request construction, response parsing, error handling
3. `Clippy` (vector service) â€” add/search/delete operations
4. RAG context building â€” the logic in `processCapturedText` (once extracted)
5. `ActionDetector` â€” content type classification

**Blockers**: Singletons (`ClipboardService.shared`, `ActionDetector.shared`) prevent mocking. Refactor to protocol-based injection.

---

## P2 â€” IMPORTANT (This Quarter)

### 8. Missing Features Users Expect

| Feature | Why It Matters | Effort |
|---------|---------------|--------|
| **Folders / Collections** | Users want to organize clips beyond just "All" and "Favorites" | Medium |
| **Snippets / Templates** | Reusable text with variable placeholders (e.g., email templates) | Medium |
| **Pinned items** | Permanently accessible items (not just favorites â€” pinned to top) | Small |
| **Rich media preview** | Preview images, links (with Open Graph), files in detail view | Medium |
| **Search filters** | Filter by date range, content type, source app, tags | Small |
| **Keyboard-first navigation** | Arrow keys to browse, Enter to copy, Cmd+1-9 for recent items | Small |
| **Export / Import** | Export history as JSON/CSV; import from other clipboard managers | Small |
| **iCloud sync** | Sync clipboard history across Macs | Large |
| **Menu bar mode** | Quick-access from menu bar icon (like Maccy, Paste) | Medium |
| **Onboarding flow** | First-run tutorial explaining permissions and features | Medium |

### 9. UX Gaps and Rough Edges

| Gap | Details |
|-----|---------|
| **No first-run experience** | User gets dumped into an empty app with no guidance on permissions, API keys, or features |
| **Hotkey discoverability** | Option+X/V/Space are powerful but invisible. Need tooltip overlays or onboarding |
| **No loading/progress states** | Model download, vector DB init, first AI query â€” all show no progress |
| **Error messages are developer-facing** | Errors print to console instead of showing user-friendly alerts |
| **No undo for text replacement** | Option+X replaces text with AI answer â€” no way to undo if wrong |
| **Clipboard loop risk** | AI-generated text copied to clipboard gets re-captured as new item |
| **No feedback on copy** | Copying from detail view gives no visual confirmation |
| **Hardcoded timing in text replacement** | 0.2s/0.5s delays in `TextCaptureService` break on slow systems |

### 10. Code Cleanup

| Issue | Where | Action |
|-------|-------|--------|
| Dead code: `AIActor.swift` | Entire file | Delete â€” never called |
| Dead code: `handleHotkeyTrigger()` | `ContentView.swift:200-203` | Delete â€” Option+S does nothing |
| Dead code: `positionWindow(nearTextInput:)` ignores parameter | `ClippyWindowController.swift:361` | Remove unused positioning code |
| Dead code: `ActionDetector` results never rendered | `ClipboardListView.swift:231` | Either render actions in UI or remove |
| Dead code: `LocalAIService.generateVisionDescription()` | Returns input unchanged | Remove placeholder |
| Duplicated context menu | `ClipboardListView.swift:31-65, 88-122` | Extract to shared `clipboardContextMenu()` ViewModifier |
| Duplicated API key readers | `ContentView.swift:602-646` | Extract generic `readKey(name:)` |
| Duplicated `getImagesDirectory()` | `ClipboardMonitor.swift:108`, `ClipboardService:289` | Move to a single utility |
| Duplicated JSON cleanup | `GeminiService.swift:296-303, 409-417` | Extract `cleanMarkdownJSON()` helper |
| Confusing naming: `Clippy` class = vector DB | `Clippy.swift` | Rename to `VectorSearchService` |

---

## P3 â€” NICE TO HAVE (Backlog)

### 11. Over-Engineering to Simplify

These aren't bugs, but the complexity-to-value ratio is unfavorable:

| Current Approach | Simpler Alternative | Impact |
|-----------------|---------------------|--------|
| Vector DB (Qwen3-Embedding-0.6B, 768 dims) for searching hundreds of text snippets | SQLite FTS5 full-text search | Eliminates model download, faster init, lower memory |
| Local 1.5B LLM (Qwen2.5) for tag generation | Regex/heuristic classification (URLs, emails, code, JSON, addresses) | Eliminates model loading; `ActionDetector` already does this |
| Fake streaming in LocalAIService (adds 10ms sleep between words) | Real streaming or just show complete response | Removes misleading UX |
| VisionScreenParser (500 LOC) for OCR | Apple's built-in Live Text (macOS Ventura+) | Less code to maintain |
| ElevenLabs API for speech-to-text | macOS built-in dictation (Ctrl+Cmd+Space) or Apple Speech framework | Removes external dependency |

### 12. Concurrency Fixes

| Issue | Where | Fix |
|-------|-------|-----|
| `@MainActor` on compute-heavy services | `Clippy.swift`, `LocalAIService.swift`, `GeminiService.swift` | Remove `@MainActor`; use explicit `@MainActor` only for UI-touching code |
| `DispatchSemaphore` in async context | `VisionScreenParser.swift:127` | Use `withCheckedContinuation` |
| Timer captures self strongly | `ClipboardMonitor.swift:56` | Use `[weak self]` in timer closure |
| `usleep()` blocking thread | `TextCaptureService.swift:294` | Use `Task.sleep(nanoseconds:)` |
| Nested `Task` inside `MainActor.run` | `ClipboardMonitor.swift:258` | Flatten into single async flow |
| `Task.detached` with `[weak self]` â€” self can nil between awaits | `ClipboardMonitor.swift:158` | Re-check self after each await |

### 13. Competitive Feature Gaps

Compared to **Paste**, **Raycast**, **Alfred**, **Maccy**:

| Feature | Competitors Have It | Clippy Has It |
|---------|-------------------|---------------|
| Menu bar quick-access | Yes | No |
| Keyboard-first navigation | Yes | Partial |
| iCloud sync | Paste, some others | No |
| Folders/collections | Paste | No |
| Snippet templates | Alfred, Raycast | No |
| Rule-based automation | Alfred | No |
| App Store distribution | Maccy, Paste | No (sandbox disabled) |
| < 50MB memory footprint | All | No (~2GB with models) |
| Zero-config setup | Maccy | No (API keys, permissions, model downloads) |
| Universal clipboard (iOS) | Paste | No |

### 14. Platform Risk Mitigation

| Risk | Mitigation |
|------|-----------|
| Apple adds native clipboard AI | Differentiate with privacy-first local processing, developer-specific features |
| macOS restricts CGEvent taps further | Build fallback using Accessibility API-based shortcuts or `NSEvent.addGlobalMonitorForEvents` |
| Third-party ML packages abandoned | Pin versions; evaluate forking VecturaMLXKit |
| Gemini API pricing/deprecation | Abstract AI service; add OpenAI/Claude as alternatives |

---

## NEW FEATURE: Status Bar Menu (Menu Bar Quick Access)

> Analyzed by a dedicated 3-agent team: Features & UX Analyst, Technical Architect, Devil's Advocate.

### Overview

Add an `NSStatusItem` / `MenuBarExtra` to the macOS menu bar showing the last 10 copied items with one-click copy. This is the **#1 most-requested feature gap** vs competitors (Maccy, Paste, CopyClip, Raycast all have this). It transforms Clippy from a "window app you open sometimes" to an "always-available utility."

### Feature Scope

#### MVP (Must Have)
| Feature | Details |
|---------|---------|
| Menu bar icon | Paperclip icon (`systemImage: "paperclip"`) in the macOS status bar |
| Last 10 items | Reverse-chronological list, auto-updated as new clips arrive |
| Click to copy | Single click copies item content to clipboard |
| Text truncation | Max 50 characters per item, single-line, with ellipsis |
| Content type icons | `doc.text` for text, `photo` for images, `chevron.left.forwardslash.chevron.right` for code |
| Source app label | Small secondary text showing which app the item came from |
| Keyboard shortcuts | `Cmd+1` through `Cmd+0` to copy items by position |
| Open main window | "Open Clippy" button at bottom to show the full app |
| Quit option | "Quit Clippy" at the very bottom |

#### Phase 2 (Nice to Have)
| Feature | Details |
|---------|---------|
| Inline search | Search field at top of the menu for filtering |
| Favorites section | Pinned/favorite items shown above recent items, separated by divider |
| Clear history | Quick action to clear all clipboard history |
| AI status indicator | Show which AI service is active (Local/Gemini) |
| Pin items | Right-click or hover action to pin an item to the top |

#### Explicitly Out of Scope (Cut)
| Feature | Reason |
|---------|--------|
| Image previews in menu | Performance risk; menus must open instantly. Show `[Image]` placeholder instead |
| AI Q&A from menu | Over-scoping; keep the menu for quick copy, use Option+X for AI |
| Settings in menu | Settings belong in the main window |
| Drag and drop from menu | MenuBarExtra doesn't support this reliably |

### UX Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ“Ž  Clippy                           â”‚  â† Menu bar icon
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  ðŸ“„ Meeting notes from sta...  âŒ˜1   â”‚  â† Most recent
â”‚     Safari Â· 2m ago                  â”‚
â”‚                                      â”‚
â”‚  ðŸ“„ https://github.com/pr/...  âŒ˜2   â”‚
â”‚     Chrome Â· 15m ago                 â”‚
â”‚                                      â”‚
â”‚  ðŸ–¼ï¸ [Image]                    âŒ˜3   â”‚  â† Image item
â”‚     Figma Â· 1h ago                   â”‚
â”‚                                      â”‚
â”‚  ðŸ“„ npm install --save-dev...  âŒ˜4   â”‚
â”‚     Terminal Â· 2h ago                â”‚
â”‚                                      â”‚
â”‚  ... (up to 10 items)                â”‚
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ðŸ“‹ Open Clippy              âŒ˜O     â”‚
â”‚  â»  Quit                     âŒ˜Q     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Interaction Patterns
- **Click**: Copies item to clipboard. Brief visual feedback (checkmark flash or menu dismisses).
- **Hover**: Shows full content in a tooltip (for truncated items).
- **Right-click**: Future â€” pin, delete, favorite.
- **Empty state**: "No clipboard history yet. Copy something to get started."

### Technical Architecture

#### Approach: SwiftUI `MenuBarExtra` (`.window` style)

**Why MenuBarExtra over NSStatusItem:**
- The app is 100% SwiftUI + SwiftData. `MenuBarExtra` slots directly into the existing `Scene` builder.
- Shares `ModelContainer` automatically with `WindowGroup` via `.modelContainer()`.
- No need for `NSApplicationDelegate`, `NSMenu`, or delegate wiring.
- The app already targets macOS 14+ (SwiftData requirement), so MenuBarExtra (macOS 13+) is available.

#### Architecture Diagram

```
ClippyApp (App)
â”œâ”€â”€ sharedModelContainer (single source of truth)
â”œâ”€â”€ AppDependencyContainer (@StateObject, shared)
â”‚
â”œâ”€â”€ Scene: WindowGroup
â”‚   â””â”€â”€ ContentView
â”‚       â”œâ”€â”€ @Query allItems
â”‚       â””â”€â”€ @EnvironmentObject container
â”‚
â””â”€â”€ Scene: MenuBarExtra          â† NEW
    â””â”€â”€ StatusBarMenu            â† NEW FILE
        â”œâ”€â”€ @Query (fetchLimit: 10, sort: .reverse)
        â””â”€â”€ @EnvironmentObject container
```

#### File-by-File Implementation Plan

**File 1: `Clippy/App/ClippyApp.swift`** (MODIFY)

```swift
@main
struct ClippyApp: App {
    var sharedModelContainer: ModelContainer = { /* existing */ }()
    @StateObject private var container = AppDependencyContainer()

    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(container)
                .fontDesign(.rounded)
                .preferredColorScheme(.dark)
                .onAppear {
                    container.inject(modelContext: sharedModelContainer.mainContext)
                }
        }
        .modelContainer(sharedModelContainer)

        MenuBarExtra {                              // â† ADD
            StatusBarMenu()                         // â† ADD
                .environmentObject(container)       // â† ADD
                .modelContainer(sharedModelContainer) // â† ADD
        } label: {                                  // â† ADD
            Image(systemName: "paperclip")          // â† ADD
        }                                           // â† ADD
        .menuBarExtraStyle(.window)                 // â† ADD
    }
}
```

Key changes:
- Add `MenuBarExtra` scene alongside existing `WindowGroup`
- Share the same `sharedModelContainer` and `container` with both scenes
- Use `.window` style for a rich SwiftUI popover (not plain `NSMenu`)

**File 2: `Clippy/UI/StatusBarMenu.swift`** (NEW â€” ~150-200 lines)

```swift
import SwiftUI
import SwiftData

struct StatusBarMenu: View {
    @Environment(\.modelContext) private var modelContext
    @EnvironmentObject var container: AppDependencyContainer
    @Query(sort: \Item.timestamp, order: .reverse, fetchLimit: 10)
    private var recentItems: [Item]

    var body: some View {
        VStack(spacing: 0) {
            // Header
            // Recent items list (each row: icon + truncated text + app name + shortcut)
            // Footer: Open Clippy + Quit
        }
        .frame(width: 320)
    }

    private func copyItem(_ item: Item) {
        container.clipboardMonitor.skipNextClipboardChange = true
        if item.contentType == "image", let imagePath = item.imagePath {
            ClipboardService.shared.copyImageToClipboard(imagePath: imagePath)
        } else {
            ClipboardService.shared.copyTextToClipboard(item.content)
        }
        item.usageCount += 1
    }
}
```

**File 3: `Clippy/Services/ClipboardMonitor.swift`** (MODIFY â€” ~5 lines)

Add clipboard feedback loop prevention:

```swift
// Add property:
var skipNextClipboardChange: Bool = false

// In checkClipboard(), after detecting change:
if skipNextClipboardChange {
    skipNextClipboardChange = false
    return
}
```

**File 4: `Clippy/UI/ContentView.swift`** (MODIFY â€” ~3 lines)

Remove lifecycle calls from `onDisappear` that would kill monitoring when the window closes:

```swift
// DELETE these from onDisappear:
// clipboardMonitor.stopMonitoring()   â† REMOVE
// hotkeyManager.stopListening()       â† REMOVE
```

Monitoring should be app-lifetime, not window-lifetime. The `MenuBarExtra` keeps the app alive.

#### Estimated Scope

| File | Action | Lines Changed | Complexity |
|------|--------|--------------|------------|
| `ClippyApp.swift` | Modify | +10 | Low |
| `StatusBarMenu.swift` | New | ~150-200 | Medium |
| `ClipboardMonitor.swift` | Modify | +8 | Low |
| `ContentView.swift` | Modify | -3 | Trivial |
| **Total** | | **~220 lines** | **Medium** |

### Risks & Mitigations (Devil's Advocate)

| Risk | Severity | Mitigation |
|------|----------|------------|
| **Privacy: Passwords visible in menu dropdown** | HIGH | Integrate with sensitive content detection (P1 #6). Mask items tagged as sensitive with `â€¢â€¢â€¢â€¢â€¢â€¢` in the menu. Add "Show/Hide" toggle. |
| **Clipboard feedback loop** | MEDIUM | `skipNextClipboardChange` flag + existing `findDuplicate` check provides double protection. Tested pattern used by Maccy/Paste. |
| **MenuBarExtra sizing bugs** | LOW | Using `.window` style which is more reliable than `.menu` style. App targets macOS 14+ where most bugs are fixed. |
| **SwiftData @Query across scenes** | LOW | Both scenes share the same `ModelContainer` via `.modelContainer()`. This is the officially supported pattern. |
| **App stays alive when window closes** | LOW | This is the desired behavior. `MenuBarExtra` keeps the process alive automatically. No `LSUIElement` hack needed. |
| **Memory from keeping app alive** | LOW | The `StatusBarMenu` view is created/destroyed each time the popover opens/closes. Only the `AppDependencyContainer` stays in memory (it already does). |
| **Menu bar crowding** | LOW | Make the status bar icon optional via a toggle in Settings. Default: ON. |
| **Performance: Menu must open instantly** | LOW | `@Query(fetchLimit: 10)` only loads 10 items. No images rendered. Text truncation is cheap. |

### Integration with Existing Improvement Plan

This feature **depends on** and **enables** other items:

| Dependency | Relationship |
|-----------|-------------|
| P1 #6: Privacy Controls | **Should be done first.** The menu amplifies privacy risk by showing clipboard content in a visible dropdown. Sensitive content masking is critical. |
| P1 #4: Extract business logic | The `copyItem()` logic in `StatusBarMenu` partially duplicates `ClipboardListView.copyToClipboard()`. Extracting a shared copy service first avoids this. |
| P2 #9: Clipboard loop risk | The `skipNextClipboardChange` flag fixes this for both the status menu AND existing copy actions. |
| P3 #13: Competitive gaps | This directly closes the "#1 competitive gap" â€” menu bar quick-access. |

---

## Recommended Execution Order

```
Phase 1 â€” Security & Stability (1-2 weeks)
â”œâ”€â”€ Migrate API keys to Keychain
â”œâ”€â”€ Add sensitive content detection
â”œâ”€â”€ Fix fatalError on schema migration
â”œâ”€â”€ Replace force casts with safe casts
â”œâ”€â”€ Remove all print() of user data
â””â”€â”€ Fix vector DB initialization race

Phase 2 â€” Architecture & Performance (2-3 weeks)
â”œâ”€â”€ Extract business logic from ContentView
â”œâ”€â”€ Optimize clipboard polling
â”œâ”€â”€ Add pagination for item queries
â”œâ”€â”€ Delete dead code (~300 lines)
â”œâ”€â”€ Remove code duplication
â””â”€â”€ Add basic test suite (repository, services)

Phase 3 â€” Status Bar Menu + Features (3-4 weeks)
â”œâ”€â”€ â˜… Status Bar Menu (MVP: last 10 items, click-to-copy, shortcuts)
â”œâ”€â”€ Fix clipboard feedback loop (skipNextClipboardChange)
â”œâ”€â”€ Fix app lifecycle (monitoring tied to app, not window)
â”œâ”€â”€ Privacy controls (exclude apps, auto-expiry, local-only mode)
â”œâ”€â”€ First-run onboarding flow
â””â”€â”€ Keyboard-first navigation

Phase 4 â€” Status Bar Menu Phase 2 + Polish (2-3 weeks)
â”œâ”€â”€ â˜… Status menu: inline search
â”œâ”€â”€ â˜… Status menu: favorites section
â”œâ”€â”€ â˜… Status menu: pin items
â”œâ”€â”€ Search filters (date, type, app)
â”œâ”€â”€ Folders/collections
â”œâ”€â”€ Fix concurrency anti-patterns
â”œâ”€â”€ Loading/progress states for model init
â””â”€â”€ Undo support for text replacement
```

---

## Metrics to Track

| Metric | Current | Target |
|--------|---------|--------|
| Test coverage | 0% | >60% core services |
| Memory usage (idle) | ~2GB (with models) | <200MB (without local models loaded) |
| Startup time to usable | ~10-30s (model loading) | <2s |
| Dead code lines | ~300 | 0 |
| Force unwraps | 8+ | 0 |
| Plaintext secrets | 4 locations | 0 |
| Console-logged user data | 6+ locations | 0 |
| Status menu open latency | N/A | <100ms |
| Menu bar accessibility | N/A | Full VoiceOver + keyboard nav |

---

*This plan was generated by analyzing every file in the codebase from three independent perspectives: features/UX, technical architecture, and risk assessment. The Status Bar Menu section was designed by a second dedicated 3-agent team.*
